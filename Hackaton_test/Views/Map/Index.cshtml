@model Hackaton_test.Models.GoogleMaps.DestinationPoint

@{
    ViewBag.Title = "Map Page";
}

<script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>

<style>
    .destinationInfo {
        height: 100px;
        width: 150px;
    }
</style>

<div id = "canvas" style="height: 300px; width: 300px;"></div>

@section scripts{
    <script type="text/javascript">
        
        $(document).ready(function() {
            GetMap();        
        });
        
        function GetMap(){
            
            google.maps.visualRefresh = true;
            
            var Lviv = new google.maps.LatLng(49.84151298033176, 24.03110414044847);
            
            var mapOptions = {
                zoom: 15,   
                center: Lviv,
                mapTypeId: google.maps.MapTypeId.G_NORMAL_MAP
            };
            
            
            var map = new google.maps.Map(document.getElementById("canvas"), mapOptions);
            
            var myLatlng = new google.maps.LatLng(49.84151298033176, 24.03110414044847);
            
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map, 
                title: 'Точки прибуття'
            });
            
            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png')
            
            $.getJSON('@Url.Action("GetData", "Map")', function (data) {
                
                $.each(data, function (i, item){
                    var marker = new google.maps.Marker({
                        'position': new google.maps.LatLng(item.GeoLong, item.GeoLat),
                        'map': map,
                        'title': item.PlaceName
                    });
                    
                    marker.serIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png')
                    
                    var infowindow = new google.maps.InfoWindow({
                        content: "<div class='destinationInfo'><h2>Точка прибуття: " + item.PlaceName + "</h2><div><h4>Пасажиропотік: "
                         + item.Traffic + " млн. людей</h4></div></div>"   
                    });
                    
                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map,  marker);
                    });
                });
            });
        }
            
    </script>
}
